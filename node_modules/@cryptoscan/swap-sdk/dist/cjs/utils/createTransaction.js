"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createTransaction = void 0;
const web3_js_1 = require("@solana/web3.js");
const constants_js_1 = require("./constants.js");
const loadTransaction_js_1 = require("./loadTransaction.js");
function filterAndConvert(obj) {
    const result = {};
    for (const key in obj) {
        if (typeof obj[key] === 'string' || typeof obj[key] === 'number') {
            result[key] = obj[key].toString();
        }
    }
    return result;
}
const createTransaction = async (params) => {
    const searchParams = new URLSearchParams(filterAndConvert(params));
    console.log(searchParams.toString());
    const response = await fetch(`${constants_js_1.ENDPOINT}/createTransaction?${searchParams.toString()}`);
    if (!response.ok) {
        console.log(response);
        throw new Error(`Failed to create transaction: ${response.statusText}`);
    }
    const data = await response.json();
    if (!('txn' in data)) {
        throw new Error('Failed to create transaction: no txn found in response');
    }
    const txn = data.txn;
    const transaction = web3_js_1.VersionedTransaction.deserialize(Buffer.from(txn, "base64"));
    const instructions = transaction.message
        .instructions;
    return (0, loadTransaction_js_1.loadTransaction)({ txn: data.txn, ...params });
};
exports.createTransaction = createTransaction;
