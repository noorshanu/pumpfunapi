"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createConnection = void 0;
const web3_js_1 = require("@solana/web3.js");
const https_proxy_agent_1 = require("https-proxy-agent");
const node_fetch_1 = __importDefault(require("node-fetch"));
// eslint-disable-next-line @typescript-eslint/no-explicit-any
global.fetch = node_fetch_1.default;
const createConnection = (url, getProxy, parameters = {}) => {
    return new web3_js_1.Connection(url || "https://api.mainnet-beta.solana.com", {
        disableRetryOnRateLimit: true,
        wsEndpoint: "wss://api.mainnet-beta.solana.com/",
        fetch: getProxy
            ? async (input, options) => {
                const processedInput = typeof input === "string" && input.slice(0, 2) === "//"
                    ? "https:" + input
                    : input;
                // eslint-disable-next-line @typescript-eslint/no-explicit-any
                return global.fetch(processedInput, {
                    ...options,
                    agent: getProxy ? new https_proxy_agent_1.HttpsProxyAgent(getProxy()) : undefined,
                });
            }
            : undefined,
        ...parameters,
    });
};
exports.createConnection = createConnection;
